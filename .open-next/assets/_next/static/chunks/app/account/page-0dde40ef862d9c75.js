(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{6151:(e,a,s)=>{"use strict";s.d(a,{default:()=>u});var r=s(5155),t=s(2115),i=s(63),l=s(7003),n=s(6170),o=s(235),d=s(3209),c=s(8525),m=s(1195);function u(){let[e,a]=(0,t.useState)(null),[s,u]=(0,t.useState)(null),[h,w]=(0,t.useState)({email:"",username:"",currentPassword:"",newPassword:"",confirmPassword:""}),[g,p]=(0,t.useState)(!1),[x,f]=(0,t.useState)(!0),y=(0,i.useRouter)(),b=(0,c.createClient)(),{showNotification:j}=(0,m.E)();(0,t.useEffect)(()=>{(async()=>{let{data:{user:e}}=await b.auth.getUser();if(!e)return y.push("/login");a(e);let{data:s}=await b.from("profiles").select("*").eq("id",e.id).single();s&&(u(s),w(a=>({...a,email:e.email||"",username:s.username||""}))),f(!1)})()},[y,b]);let N=e=>{w(a=>({...a,[e.target.name]:e.target.value}))},v=async()=>{p(!0);try{if(h.username!==s.username){let{data:a}=await b.from("profiles").select("username").eq("username",h.username).neq("id",e.id).single();if(a){j({type:"error",title:"Nombre de usuario no disponible",message:"Este nombre de usuario ya est\xe1 en uso"}),p(!1);return}}let{error:a}=await b.from("profiles").update({username:h.username,email:h.email}).eq("id",e.id);if(a)return void j({type:"error",title:"Error al actualizar perfil",message:a.message});if(h.email!==e.email){let{error:e}=await b.auth.updateUser({email:h.email});if(e)return void j({type:"error",title:"Error al actualizar email",message:e.message});j({type:"info",title:"Email actualizado",message:"Revisa tu nuevo email para confirmar el cambio"})}j({type:"success",title:"Perfil actualizado",message:"Tu informaci\xf3n ha sido actualizada exitosamente"}),u(e=>({...e,username:h.username,email:h.email}))}catch(e){j({type:"error",title:"Error inesperado",message:"Ocurri\xf3 un error al actualizar el perfil"})}finally{p(!1)}},P=async()=>{if(!h.newPassword||!h.confirmPassword)return void j({type:"error",title:"Error de validaci\xf3n",message:"Completa todos los campos de contrase\xf1a"});if(h.newPassword!==h.confirmPassword)return void j({type:"error",title:"Error de validaci\xf3n",message:"Las contrase\xf1as no coinciden"});if(h.newPassword.length<6)return void j({type:"error",title:"Error de validaci\xf3n",message:"La contrase\xf1a debe tener al menos 6 caracteres"});p(!0);try{let{error:e}=await b.auth.updateUser({password:h.newPassword});if(e)return void j({type:"error",title:"Error al cambiar contrase\xf1a",message:e.message});j({type:"success",title:"Contrase\xf1a actualizada",message:"Tu contrase\xf1a ha sido cambiada exitosamente"}),w(e=>({...e,currentPassword:"",newPassword:"",confirmPassword:""}))}catch(e){j({type:"error",title:"Error inesperado",message:"Ocurri\xf3 un error al cambiar la contrase\xf1a"})}finally{p(!1)}};return x?(0,r.jsx)("div",{className:"text-center py-8",children:(0,r.jsx)("p",{className:"text-white",children:"Cargando informaci\xf3n..."})}):(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)(d.Zp,{className:"bg-gray-700 border-gray-600",children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-white",children:"Personal Information"})}),(0,r.jsxs)(d.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"email",className:"text-white",children:"Email"}),(0,r.jsx)(n.p,{id:"email",name:"email",type:"email",value:h.email,onChange:N,className:"bg-gray-600 border-gray-500 text-white"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"username",className:"text-white",children:"Username"}),(0,r.jsx)(n.p,{id:"username",name:"username",type:"text",value:h.username,onChange:N,className:"bg-gray-600 border-gray-500 text-white"})]}),(0,r.jsx)(l.$,{onClick:v,disabled:g,className:"bg-blue-600 hover:bg-blue-700 text-white",children:g?"Updating...":"Update Profile"})]})]}),(0,r.jsxs)(d.Zp,{className:"bg-gray-700 border-gray-600",children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-white",children:"Change Password"})}),(0,r.jsxs)(d.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"newPassword",className:"text-white",children:"New Password"}),(0,r.jsx)(n.p,{id:"newPassword",name:"newPassword",type:"password",value:h.newPassword,onChange:N,placeholder:"••••••••",className:"bg-gray-600 border-gray-500 text-white"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"confirmPassword",className:"text-white",children:"Confirm New Password"}),(0,r.jsx)(n.p,{id:"confirmPassword",name:"confirmPassword",type:"password",value:h.confirmPassword,onChange:N,placeholder:"••••••••",className:"bg-gray-600 border-gray-500 text-white"})]}),(0,r.jsx)(l.$,{onClick:P,disabled:g,className:"bg-red-600 hover:bg-red-700 text-white",children:g?"Changing...":"Change Password"})]})]}),(0,r.jsxs)(d.Zp,{className:"bg-gray-700 border-gray-600",children:[(0,r.jsx)(d.aR,{children:(0,r.jsx)(d.ZB,{className:"text-white",children:"Account Information"})}),(0,r.jsx)(d.Wu,{children:(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("p",{className:"text-gray-300",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Type of account:"})," ",(null==s?void 0:s.role)==="admin"?"Administrador":"Usuario"]}),(0,r.jsxs)("p",{className:"text-gray-300",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Member since:"})," ",new Date(null==e?void 0:e.created_at).toLocaleDateString("es-ES")]}),(0,r.jsxs)("p",{className:"text-gray-300",children:[(0,r.jsx)("span",{className:"font-semibold",children:"User ID:"})," ",null==e?void 0:e.id]})]})})]})]})}},7512:(e,a,s)=>{Promise.resolve().then(s.bind(s,6151))}},e=>{e.O(0,[96,76,358],()=>e(e.s=7512)),_N_E=e.O()}]);