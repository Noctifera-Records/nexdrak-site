(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{2017:(e,s,a)=>{Promise.resolve().then(a.bind(a,8495))},8495:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>M});var r=a(5155),l=a(2115),t=a(8843),i=a(7003),n=a(6881);class c{async getAllSongs(){return(0,n.OW)(async()=>{let{data:e,error:s}=await this.supabase.from("songs").select("*").order("created_at",{ascending:!1});if(s)throw Error((0,n.nl)(s,"fetch songs"));return e||[]})}async createSong(e){return(0,n.OW)(async()=>{var s,a,r,l,t,i;if(!(null==(s=e.title)?void 0:s.trim()))throw Error("El t\xedtulo es requerido");if(!(null==(a=e.artist)?void 0:a.trim()))throw Error("El artista es requerido");if(!(null==(r=e.stream_url)?void 0:r.trim()))throw Error("La URL de streaming es requerida");try{new URL(e.stream_url)}catch(e){throw Error("La URL de streaming no es v\xe1lida")}if(e.release_date&&isNaN(new Date(e.release_date).getTime()))throw Error("La fecha de lanzamiento no es v\xe1lida");let c={title:e.title.trim(),artist:e.artist.trim(),stream_url:e.stream_url.trim(),cover_image_url:(null==(l=e.cover_image_url)?void 0:l.trim())||null,type:e.type,album_name:"album"===e.type&&(null==(t=e.album_name)?void 0:t.trim())||null,track_number:"album"===e.type&&e.track_number?Number(e.track_number):null,release_date:e.release_date||null,youtube_embed_id:(null==(i=e.youtube_embed_id)?void 0:i.trim())||null},{data:d,error:m}=await this.supabase.from("songs").insert([c]).select().single();if(m)throw Error((0,n.nl)(m,"create song"));return d})}async updateSong(e,s){return(0,n.OW)(async()=>{var a,r,l,t,i,c;if(void 0!==s.title&&!(null==(a=s.title)?void 0:a.trim()))throw Error("El t\xedtulo es requerido");if(void 0!==s.artist&&!(null==(r=s.artist)?void 0:r.trim()))throw Error("El artista es requerido");if(void 0!==s.stream_url&&!(null==(l=s.stream_url)?void 0:l.trim()))throw Error("La URL de streaming es requerida");if(s.stream_url)try{new URL(s.stream_url)}catch(e){throw Error("La URL de streaming no es v\xe1lida")}if(s.release_date&&isNaN(new Date(s.release_date).getTime()))throw Error("La fecha de lanzamiento no es v\xe1lida");void 0!==s.type&&(["album","single"].includes(s.type)||(s.type="single"),s.type=String(s.type).trim());let d={};void 0!==s.title&&(d.title=s.title.trim()),void 0!==s.artist&&(d.artist=s.artist.trim()),void 0!==s.stream_url&&(d.stream_url=s.stream_url.trim()),void 0!==s.cover_image_url&&(d.cover_image_url=(null==(t=s.cover_image_url)?void 0:t.trim())||null),void 0!==s.album_name&&(d.album_name=(null==(i=s.album_name)?void 0:i.trim())||null),void 0!==s.track_number&&(d.track_number=s.track_number?Number(s.track_number):null),void 0!==s.release_date&&(d.release_date=s.release_date||null),void 0!==s.youtube_embed_id&&(d.youtube_embed_id=(null==(c=s.youtube_embed_id)?void 0:c.trim())||null),d.type&&!["album","single"].includes(d.type)&&(d.type="single");let{data:m,error:o}=await this.supabase.from("songs").update(d).eq("id",e).select().single();if(o)throw Error((0,n.nl)(o,"update song"));return m})}async deleteSong(e){return(0,n.OW)(async()=>{let{error:s}=await this.supabase.from("songs").delete().eq("id",e);if(s)throw Error((0,n.nl)(s,"delete song"));return!0})}async getExistingAlbums(){return(0,n.OW)(async()=>{let{data:e,error:s}=await this.supabase.from("songs").select("album_name").eq("type","album").not("album_name","is",null);return s?[]:[...new Set(null==e?void 0:e.map(e=>e.album_name).filter(Boolean))]})}constructor(){this.supabase=(0,n.UU)()}}var d=a(5239),m=a(877),o=a(1010),u=a(5880),x=a(859),h=a(3586),g=a(5921),p=a(6168),j=a(1360),b=a(5130),f=a(3209),v=a(7812);function y(e){let{songs:s,streamingLinks:a,onEdit:l,onDelete:t,onManageLinks:n}=e,c=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),y=e=>"album"===e?(0,r.jsx)(m.A,{className:"h-4 w-4"}):(0,r.jsx)(p.A,{className:"h-4 w-4"}),N=e=>"album"===e?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800",_=e=>a.filter(s=>s.song_id===e),w=e=>{let s=_(e);return s.find(e=>e.is_primary)||s[0]},k=e=>({spotify:b.A,youtube:g.A,apple_music:h.A,soundcloud:b.A,bandcamp:h.A,deezer:b.A,tidal:b.A,amazon_music:h.A})[e]||u.A;return 0===s.length?(0,r.jsx)(f.Zp,{children:(0,r.jsxs)(f.Wu,{className:"p-8 text-center",children:[(0,r.jsx)(h.A,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"No hay canciones registradas."})]})}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"hidden lg:block",children:(0,r.jsxs)(f.Zp,{children:[(0,r.jsx)(f.aR,{children:(0,r.jsxs)(f.ZB,{children:["Canciones (",s.length,")"]})}),(0,r.jsx)(f.Wu,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left p-2",children:"Portada"}),(0,r.jsx)("th",{className:"text-left p-2",children:"T\xedtulo"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Artista"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Tipo"}),(0,r.jsx)("th",{className:"text-left p-2",children:"\xc1lbum/Track"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Enlaces"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Fecha"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Acciones"})]})}),(0,r.jsx)("tbody",{children:s.map(e=>(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("div",{className:"w-12 h-12 relative bg-gray-200 rounded",children:e.cover_image_url?(0,r.jsx)(d.default,{src:e.cover_image_url,alt:e.title,fill:!0,className:"object-cover rounded"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:(0,r.jsx)(h.A,{className:"h-6 w-6"})})})}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("p",{className:"font-medium",children:e.title})}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("p",{className:"text-gray-600",children:e.artist})}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)(v.E,{className:N(e.type),children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[y(e.type),"album"===e.type?"\xc1lbum":"Single"]})})}),(0,r.jsx)("td",{className:"p-2",children:"album"===e.type&&e.album_name?(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-sm",children:e.album_name}),e.track_number&&(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Track #",e.track_number]})]}):(0,r.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,r.jsx)("td",{className:"p-2",children:(()=>{let s=_(e.id);return(w(e.id),0===s.length)?(0,r.jsxs)("div",{className:"flex items-center gap-1 text-gray-400",children:[(0,r.jsx)(u.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{className:"text-xs",children:"Legacy URL"})]}):(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"flex -space-x-1",children:s.slice(0,3).map(e=>{let s=k(e.platform);return(0,r.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center text-xs ".concat(e.is_primary?"bg-green-500 text-white":"bg-gray-200 text-gray-600"),title:"".concat(e.platform).concat(e.is_primary?" (Primary)":""),children:(0,r.jsx)(s,{className:"h-3 w-3"})},e.id)})}),s.length>3&&(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["+",s.length-3]}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["(",s.length,")"]})]})})()}),(0,r.jsx)("td",{className:"p-2 text-sm text-gray-500",children:e.release_date?c(e.release_date):c(e.created_at)}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(()=>{let s=w(e.id),a=(null==s?void 0:s.url)||e.stream_url;return(0,r.jsx)(i.$,{variant:"ghost",size:"sm",asChild:!0,children:(0,r.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",title:"Escuchar canci\xf3n",children:(0,r.jsx)(u.A,{className:"h-4 w-4"})})})})(),(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>n(e),title:"Gestionar enlaces de streaming",children:(0,r.jsx)(x.A,{className:"h-4 w-4"})}),(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>l(e),children:(0,r.jsx)(o.A,{className:"h-4 w-4"})}),(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>t(e.id),className:"text-red-600 hover:text-red-700",children:(0,r.jsx)(j.A,{className:"h-4 w-4"})})]})})]},e.id))})]})})})]})}),(0,r.jsx)("div",{className:"lg:hidden space-y-4",children:s.map(e=>(0,r.jsx)(f.Zp,{children:(0,r.jsx)(f.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 relative bg-gray-200 rounded flex-shrink-0",children:e.cover_image_url?(0,r.jsx)(d.default,{src:e.cover_image_url,alt:e.title,fill:!0,className:"object-cover rounded"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:(0,r.jsx)(h.A,{className:"h-8 w-8"})})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium truncate",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.artist})]}),(0,r.jsx)(v.E,{className:N(e.type),children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[y(e.type),"album"===e.type?"\xc1lbum":"Single"]})})]}),"album"===e.type&&e.album_name&&(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:e.album_name}),e.track_number&&(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Track #",e.track_number]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:e.release_date?c(e.release_date):c(e.created_at)}),(0,r.jsx)("div",{className:"mb-3",children:(()=>{let s=_(e.id);return 0===s.length?(0,r.jsxs)("div",{className:"flex items-center gap-1 text-gray-400",children:[(0,r.jsx)(u.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{className:"text-xs",children:"Using legacy URL"})]}):(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"flex -space-x-1",children:s.slice(0,4).map(e=>{let s=k(e.platform);return(0,r.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-white flex items-center justify-center text-xs ".concat(e.is_primary?"bg-green-500 text-white":"bg-gray-200 text-gray-600"),title:"".concat(e.platform).concat(e.is_primary?" (Primary)":""),children:(0,r.jsx)(s,{className:"h-3 w-3"})},e.id)})}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[s.length," platform",1!==s.length?"s":""]})]})})()}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(()=>{let s=w(e.id),a=(null==s?void 0:s.url)||e.stream_url;return(0,r.jsx)(i.$,{variant:"outline",size:"sm",asChild:!0,children:(0,r.jsxs)("a",{href:a,target:"_blank",rel:"noopener noreferrer",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Listen"]})})})(),(0,r.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>n(e),children:[(0,r.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Links"]}),(0,r.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>l(e),children:[(0,r.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,r.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>t(e.id),className:"text-red-600 hover:text-red-700",children:[(0,r.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})})},e.id))})]})}var N=a(6363),_=a(6170),w=a(235),k=a(3550),A=a(6014),C=a(2056),E=a(5710),S=a(7910),L=a(508),z=a(3101),q=a(5016);let R=(0,z.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),T=l.forwardRef((e,s)=>{let{className:a,variant:l,...t}=e;return(0,r.jsx)("div",{ref:s,role:"alert",className:(0,q.cn)(R({variant:l}),a),...t})});T.displayName="Alert",l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("h5",{ref:s,className:(0,q.cn)("mb-1 font-medium leading-none tracking-tight",a),...l})}).displayName="AlertTitle";let $=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,r.jsx)("div",{ref:s,className:(0,q.cn)("text-sm [&_p]:leading-relaxed",a),...l})});function D(e){let{error:s,operation:a}=e;return(null==s?void 0:s.includes("row-level security policy"))||(null==s?void 0:s.includes("permisos"))?(0,r.jsxs)(f.Zp,{className:"border-orange-200 bg-orange-50 dark:bg-orange-950 dark:border-orange-800",children:[(0,r.jsx)(f.aR,{children:(0,r.jsxs)(f.ZB,{className:"flex items-center gap-2 text-orange-800 dark:text-orange-200",children:[(0,r.jsx)(S.A,{className:"h-5 w-5"}),"Problema de Permisos de Seguridad"]})}),(0,r.jsxs)(f.Wu,{className:"space-y-4",children:[(0,r.jsxs)(T,{children:[(0,r.jsx)(C.A,{className:"h-4 w-4"}),(0,r.jsx)($,{children:"La operaci\xf3n fall\xf3 debido a pol\xedticas de seguridad a nivel de fila (RLS) en la base de datos."})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(L.A,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-sm",children:"Verifica tu autenticaci\xf3n"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Aseg\xfarate de estar correctamente autenticado en la aplicaci\xf3n."})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(E.A,{className:"h-5 w-5 text-green-600 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-sm",children:"Soluci\xf3n para administradores"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Ve al SQL Editor de Supabase y ejecuta uno de estos scripts:"}),(0,r.jsxs)("ul",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[(0,r.jsxs)("li",{children:["• ",(0,r.jsx)("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 rounded",children:"sql/fix-songs-rls-simple.sql"})," (recomendado)"]}),(0,r.jsxs)("li",{children:["• ",(0,r.jsx)("code",{className:"bg-gray-200 dark:bg-gray-700 px-1 rounded",children:"sql/disable-rls-temporarily.sql"})," (testing r\xe1pido)"]})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded-lg",children:[(0,r.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:[(0,r.jsx)("strong",{children:"Error t\xe9cnico:"})," ",s]}),a&&(0,r.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:[(0,r.jsx)("strong",{children:"Operaci\xf3n:"})," ",a]})]})]})]}):null}function U(e){let{song:s,onClose:a}=e,[t,n]=(0,l.useState)({title:"",artist:"",stream_url:"",cover_image_url:"",type:"single",album_name:"",track_number:"",release_date:"",youtube_embed_id:""}),[d,m]=(0,l.useState)(!1),[o,u]=(0,l.useState)([]),[x,h]=(0,l.useState)(""),g=new c;(0,l.useEffect)(()=>{if(p(),s){var e;n({title:s.title,artist:s.artist,stream_url:s.stream_url,cover_image_url:s.cover_image_url||"",type:s.type,album_name:s.album_name||"",track_number:(null==(e=s.track_number)?void 0:e.toString())||"",release_date:s.release_date||"",youtube_embed_id:s.youtube_embed_id||""})}},[s]);let p=async()=>{try{let e=await g.getExistingAlbums();u(e)}catch(e){}},j=async e=>{e.preventDefault(),m(!0),h("");try{let e={title:t.title,artist:t.artist,stream_url:t.stream_url,cover_image_url:t.cover_image_url||null,type:t.type,album_name:t.album_name||null,track_number:t.track_number?parseInt(t.track_number):null,release_date:t.release_date||null,youtube_embed_id:t.youtube_embed_id||null};s?await g.updateSong(s.id,e):await g.createSong(e),a()}catch(e){h(e.message||"Error al guardar la canci\xf3n")}finally{m(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)(f.Zp,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(f.aR,{className:"flex flex-row items-center justify-between",children:[(0,r.jsx)(f.ZB,{children:s?"Editar Canci\xf3n":"Agregar Canci\xf3n"}),(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:a,children:(0,r.jsx)(N.X,{className:"h-4 w-4"})})]}),(0,r.jsx)(f.Wu,{children:(0,r.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"title",children:"T\xedtulo *"}),(0,r.jsx)(_.p,{id:"title",value:t.title,onChange:e=>n(s=>({...s,title:e.target.value})),placeholder:"Nombre de la canci\xf3n",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"artist",children:"Artista *"}),(0,r.jsx)(_.p,{id:"artist",value:t.artist,onChange:e=>n(s=>({...s,artist:e.target.value})),placeholder:"Nombre del artista",required:!0})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"stream_url",children:"URL de Streaming *"}),(0,r.jsx)(_.p,{id:"stream_url",type:"url",value:t.stream_url,onChange:e=>n(s=>({...s,stream_url:e.target.value})),placeholder:"https://open.spotify.com/track/...",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"type",children:"Tipo *"}),(0,r.jsxs)(k.l6,{value:t.type,onValueChange:e=>n(s=>({...s,type:e})),children:[(0,r.jsx)(k.bq,{children:(0,r.jsx)(k.yv,{placeholder:"Selecciona el tipo"})}),(0,r.jsxs)(k.gC,{children:[(0,r.jsx)(k.eb,{value:"single",children:"Single"}),(0,r.jsx)(k.eb,{value:"album",children:"\xc1lbum"})]})]})]}),"album"===t.type&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"album_name",children:"Nombre del \xc1lbum"}),(0,r.jsx)(_.p,{id:"album_name",value:t.album_name,onChange:e=>n(s=>({...s,album_name:e.target.value})),placeholder:"Nombre del \xe1lbum",list:"existing-albums"}),(0,r.jsx)("datalist",{id:"existing-albums",children:o.map(e=>(0,r.jsx)("option",{value:e},e))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"track_number",children:"N\xfamero de Track"}),(0,r.jsx)(_.p,{id:"track_number",type:"number",min:"1",value:t.track_number,onChange:e=>n(s=>({...s,track_number:e.target.value})),placeholder:"1"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"release_date",children:"Fecha de Lanzamiento"}),(0,r.jsx)(_.p,{id:"release_date",type:"date",value:t.release_date,onChange:e=>n(s=>({...s,release_date:e.target.value}))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"youtube_embed_id",children:"YouTube Video ID"}),(0,r.jsx)(_.p,{id:"youtube_embed_id",value:t.youtube_embed_id,onChange:e=>n(s=>({...s,youtube_embed_id:e.target.value})),placeholder:"dQw4w9WgXcQ (solo el ID del video)"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:'Opcional: ID del video de YouTube para mostrar el reproductor embebido. Ejemplo: para https://www.youtube.com/watch?v=dQw4w9WgXcQ usar solo "dQw4w9WgXcQ"'})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{children:"Imagen de Portada"}),(0,r.jsx)(A.o,{onImageUpload:e=>{n(s=>({...s,cover_image_url:e}))},currentImage:t.cover_image_url})]}),x&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"bg-red-900/20 border border-red-500 text-red-200 px-4 py-3 rounded",children:x}),(0,r.jsx)(D,{error:x,operation:s?"actualizar canci\xf3n":"crear canci\xf3n"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,r.jsx)(i.$,{type:"button",variant:"outline",onClick:a,children:"Cancelar"}),(0,r.jsx)(i.$,{type:"submit",disabled:d,children:d?"Guardando...":s?"Actualizar":"Crear"})]})]})})]})})}$.displayName="AlertDescription";var W=a(6191),F=a(9347),J=a(1224),O=a(5229),P=a(8525);let Z=[{value:"spotify",label:"Spotify",color:"#17d359ff"},{value:"youtube",label:"YouTube Music",color:"#ff0000"},{value:"apple_music",label:"Apple Music",color:"#fa57c1"},{value:"soundcloud",label:"SoundCloud",color:"#ff5500"},{value:"bandcamp",label:"Bandcamp",color:"#629aa0"},{value:"deezer",label:"Deezer",color:"#eeff00ff"},{value:"tidal",label:"Tidal",color:"#e4e4e4ff"},{value:"amazon_music",label:"Amazon Music",color:"#00d9ffff"}];function I(e){let{song:s,streamingLinks:a,onClose:t}=e,[n,c]=(0,l.useState)(a),[d,m]=(0,l.useState)({platform:"",url:""}),[o,x]=(0,l.useState)(!1),[h,g]=(0,l.useState)(""),p=(0,P.createClient)();(0,l.useEffect)(()=>{c(a)},[a]);let b=async()=>{if(!d.platform||!d.url)return void g("Platform and URL are required");if(n.some(e=>e.platform===d.platform))return void g("This platform already exists for this song");x(!0),g("");try{let{data:e,error:a}=await p.from("streaming_links").insert({song_id:s.id,platform:d.platform,url:d.url,is_primary:0===n.length}).select().single();if(a)throw a;c(s=>[...s,e]),m({platform:"",url:""})}catch(e){g(e.message||"Error adding streaming link")}finally{x(!1)}},y=async e=>{if(confirm("Are you sure you want to delete this streaming link?")){x(!0);try{let{error:s}=await p.from("streaming_links").delete().eq("id",e);if(s)throw s;c(s=>s.filter(s=>s.id!==e))}catch(e){g(e.message||"Error deleting streaming link")}finally{x(!1)}}},N=async e=>{x(!0);try{await p.from("streaming_links").update({is_primary:!1}).eq("song_id",s.id);let{error:a}=await p.from("streaming_links").update({is_primary:!0}).eq("id",e);if(a)throw a;c(s=>s.map(s=>({...s,is_primary:s.id===e})))}catch(e){g(e.message||"Error setting primary link")}finally{x(!1)}},A=Z.filter(e=>!n.some(s=>s.platform===e.value));return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)(f.Zp,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(f.aR,{className:"flex flex-row items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(f.ZB,{children:"Manage Streaming Links"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[s.title," by ",s.artist]})]}),(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:t,children:(0,r.jsx)(O.A,{className:"h-4 w-4"})})]}),(0,r.jsxs)(f.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4",children:["Current Streaming Links (",n.length,")"]}),0===n.length?(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)(u.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,r.jsx)("p",{children:"No streaming links added yet"})]}):(0,r.jsx)("div",{className:"space-y-3",children:n.map(e=>{let s,a=(s=e.platform,Z.find(e=>e.value===s)||{value:s,label:s.charAt(0).toUpperCase()+s.slice(1),color:"#6b7280"});return(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(v.E,{style:{backgroundColor:a.color,color:"white"},className:"text-xs",children:a.label}),e.is_primary&&(0,r.jsxs)(v.E,{variant:"secondary",className:"text-xs",children:[(0,r.jsx)(F.A,{className:"h-3 w-3 mr-1"}),"Primary"]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.url})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.$,{variant:"ghost",size:"sm",asChild:!0,children:(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",title:"Open link",children:(0,r.jsx)(u.A,{className:"h-4 w-4"})})}),(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>N(e.id),disabled:e.is_primary||o,title:e.is_primary?"Already primary":"Set as primary",children:e.is_primary?(0,r.jsx)(F.A,{className:"h-4 w-4 text-yellow-500"}):(0,r.jsx)(J.A,{className:"h-4 w-4"})}),(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>y(e.id),disabled:o,className:"text-red-600 hover:text-red-700",children:(0,r.jsx)(j.A,{className:"h-4 w-4"})})]})]},e.id)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Add New Streaming Link"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"platform",children:"Platform"}),(0,r.jsxs)(k.l6,{value:d.platform,onValueChange:e=>m(s=>({...s,platform:e})),disabled:0===A.length,children:[(0,r.jsx)(k.bq,{children:(0,r.jsx)(k.yv,{placeholder:0===A.length?"All platforms added":"Select platform"})}),(0,r.jsx)(k.gC,{children:A.map(e=>(0,r.jsx)(k.eb,{value:e.value,children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),e.label]})},e.value))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(w.J,{htmlFor:"url",children:"URL"}),(0,r.jsx)(_.p,{id:"url",type:"url",value:d.url,onChange:e=>m(s=>({...s,url:e.target.value})),placeholder:"https://..."})]}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsxs)(i.$,{onClick:b,disabled:o||!d.platform||!d.url||0===A.length,className:"w-full",children:[(0,r.jsx)(W.A,{className:"h-4 w-4 mr-2"}),"Add Link"]})})]})]}),h&&(0,r.jsx)("div",{className:"bg-red-900/20 border border-red-500 text-red-200 px-4 py-3 rounded",children:h}),(0,r.jsxs)("div",{className:"bg-blue-900/20 border border-blue-500 text-blue-200 px-4 py-3 rounded text-sm",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"\uD83D\uDCA1 Tips:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[(0,r.jsx)("li",{children:'The primary link will be used for the main "LISTEN NOW" button'}),(0,r.jsx)("li",{children:'All links will appear in the "Available on" section'}),(0,r.jsx)("li",{children:"You can only have one link per platform per song"})]})]}),(0,r.jsx)("div",{className:"flex justify-end pt-4",children:(0,r.jsx)(i.$,{onClick:t,children:"Done"})})]})]})})}function M(){let[e,s]=(0,l.useState)([]),[n,d]=(0,l.useState)([]),[m,o]=(0,l.useState)(!0),[u,x]=(0,l.useState)(!1),[h,g]=(0,l.useState)(null),[p,j]=(0,l.useState)(null),b=new c;(0,l.useEffect)(()=>{f()},[]);let f=async()=>{try{let e=await b.getAllSongs();s(e),await v()}catch(e){}finally{o(!1)}},v=async()=>{try{let{createClient:e}=await Promise.resolve().then(a.bind(a,8525)),s=e(),{data:r,error:l}=await s.from("streaming_links").select("*").order("song_id").order("is_primary",{ascending:!1});r&&!l&&d(r)}catch(e){}},N=async e=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar esta canci\xf3n?"))try{await b.deleteSong(e),s(s=>s.filter(s=>s.id!==e))}catch(e){alert("Error al eliminar la canci\xf3n")}};return m?(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"M\xfasica"})}),(0,r.jsx)("div",{className:"text-center py-8",children:(0,r.jsx)("p",{children:"Loading songs..."})})]}):(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"M\xfasica"}),(0,r.jsxs)(i.$,{onClick:()=>x(!0),children:[(0,r.jsx)(t.F,{className:"h-4 w-4 mr-2"}),"Agregar Canci\xf3n"]})]}),(0,r.jsx)(y,{songs:e,streamingLinks:n,onEdit:e=>{g(e),x(!0)},onDelete:N,onManageLinks:e=>{j(e)}}),u&&(0,r.jsx)(U,{song:h,onClose:()=>{x(!1),g(null),f()}}),p&&(0,r.jsx)(I,{song:p,streamingLinks:n.filter(e=>e.song_id===p.id),onClose:()=>{j(null),v()}})]})}}},e=>{e.O(0,[96,76,358],()=>e(e.s=2017)),_N_E=e.O()}]);